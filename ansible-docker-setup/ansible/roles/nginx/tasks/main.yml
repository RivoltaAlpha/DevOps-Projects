---
# Nginx role - Install and configure nginx web server
- name: Install nginx
  apt:
    name: nginx
    state: present
    update_cache: yes

- name: Start and enable nginx service
  systemd:
    name: nginx
    state: started
    enabled: yes
  when: ansible_service_mgr == "systemd"
  ignore_errors: yes

- name: Configure nginx default site
  copy:
    dest: /etc/nginx/sites-available/default
    content: |
      server {
          listen 80 default_server;
          listen [::]:80 default_server;
          
          root /var/www/html;
          index index.html index.htm;
          
          server_name _;
          
          location / {
              try_files $uri $uri/ =404;
          }
          
          # Security headers
          add_header X-Frame-Options "SAMEORIGIN" always;
          add_header X-Content-Type-Options "nosniff" always;
          add_header X-XSS-Protection "1; mode=block" always;
      }
  notify: restart nginx

- name: Ensure nginx is running
  service:
    name: nginx
    state: started
  ignore_errors: yes

- name: Display nginx configuration complete message
  debug:
    msg: "Nginx installed and configured successfully!"
